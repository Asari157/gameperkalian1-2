<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tembak Hewan - Game Edukatif Hafalan Al-Qur'an</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/PointerLockControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
        
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Nunito', sans-serif;
        }
        
        #game-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 100;
        }
        
        #crosshair::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background-color: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        #score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        
        #timer-display {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: none;
        }
        
        #level-display {
            position: absolute;
            top: 60px;
            left: 20px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        
        #question-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            width: 80%;
            max-width: 500px;
            z-index: 200;
            display: none;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .answer-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .answer-btn:hover {
            background-color: #3e8e41;
            transform: scale(1.02);
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #7cc6fe, #3a86ff);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        
        #start-btn {
            padding: 15px 40px;
            font-size: 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
            font-weight: bold;
        }
        
        #start-btn:hover {
            background-color: #3e8e41;
            transform: scale(1.05);
        }
        
        #level-up-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 250;
            color: white;
        }
        
        #level-up-btn {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #ff9800;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
            font-weight: bold;
        }
        
        #level-up-btn:hover {
            background-color: #e68a00;
            transform: scale(1.05);
        }
        
        #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 250;
            color: white;
        }
        
        #restart-btn {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
            font-weight: bold;
        }
        
        #restart-btn:hover {
            background-color: #d32f2f;
            transform: scale(1.05);
        }
        
        .water-gun {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 30%;
            height: 30%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M30,70 L60,70 L70,60 L90,60 L90,40 L70,40 L60,30 L30,30 Z' fill='%2300A8E8' stroke='%23007EA7' stroke-width='2'/%3E%3Cpath d='M10,60 L30,60 L30,40 L10,40 Z' fill='%2300A8E8' stroke='%23007EA7' stroke-width='2'/%3E%3Ccircle cx='70' cy='50' r='5' fill='%23FFDD00' stroke='%23FFA700' stroke-width='1'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: bottom right;
            pointer-events: none;
            z-index: 100;
            transform: scale(0.8);
            opacity: 0.9;
        }
        
        .feedback {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            z-index: 150;
            opacity: 0;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body class="bg-blue-100">
    <div id="game-container"></div>
    <div id="crosshair"></div>
    <div id="score-display">Skor: 0</div>
    <div id="level-display">Level: 1</div>
    <div id="timer-display">Waktu: 60</div>
    <div class="water-gun"></div>
    <div class="feedback" id="feedback"></div>
    
    <div id="question-modal" class="text-center">
        <h2 class="text-2xl font-bold mb-4 text-blue-800" id="question-text">Pertanyaan</h2>
        <div id="answers-container">
            <button class="answer-btn" data-index="0">Jawaban 1</button>
            <button class="answer-btn" data-index="1">Jawaban 2</button>
            <button class="answer-btn" data-index="2">Jawaban 3</button>
        </div>
    </div>
    
    <div id="start-screen">
        <h1 class="text-5xl font-bold text-white mb-4 text-center">Tembak Hewan</h1>
        <h2 class="text-3xl text-white mb-8 text-center">Game Edukatif Hafalan Al-Qur'an</h2>
        <p class="text-xl text-white mb-6 text-center max-w-lg">Tembak hewan lucu dan jawab pertanyaan tentang Surah Al-'Ādiyāt dan At-Tīn!</p>
        <button id="start-btn">Mulai Bermain</button>
    </div>
    
    <div id="level-up-screen">
        <h1 class="text-5xl font-bold mb-4">MasyaAllah!</h1>
        <h2 class="text-3xl mb-8">Kamu Naik ke Level 2!</h2>
        <p class="text-xl mb-6 max-w-lg text-center">Sekarang hewan bergerak lebih cepat dan kamu punya batas waktu 60 detik!</p>
        <button id="level-up-btn">Lanjutkan</button>
    </div>
    
    <div id="game-over-screen">
        <h1 class="text-5xl font-bold mb-4">Waktu Habis!</h1>
        <h2 class="text-3xl mb-8">Skor Akhir: <span id="final-score">0</span></h2>
        <p class="text-xl mb-6 max-w-lg text-center">MasyaAllah, kamu sudah berusaha dengan baik!</p>
        <button id="restart-btn">Main Lagi</button>
    </div>

    <script>
        // Game variables
        let scene, camera, renderer, controls;
        let animals = [];
        let score = 0;
        let level = 1;
        let timer = 60;
        let timerInterval;
        let isGameActive = false;
        let currentAnimal = null;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let gameContainer = document.getElementById('game-container');
        let questionModal = document.getElementById('question-modal');
        let scoreDisplay = document.getElementById('score-display');
        let levelDisplay = document.getElementById('level-display');
        let timerDisplay = document.getElementById('timer-display');
        let startScreen = document.getElementById('start-screen');
        let levelUpScreen = document.getElementById('level-up-screen');
        let gameOverScreen = document.getElementById('game-over-screen');
        let feedbackElement = document.getElementById('feedback');
        
        // Questions database
        const questions = [
            {
                question: "Apa arti Al-'Ādiyāt?",
                answers: [
                    "Kuda perang yang berlari kencang",
                    "Matahari yang bersinar",
                    "Bulan yang bercahaya"
                ],
                correctIndex: 0
            },
            {
                question: "Berapa jumlah ayat Surah Al-'Ādiyāt?",
                answers: [
                    "9 ayat",
                    "11 ayat",
                    "13 ayat"
                ],
                correctIndex: 1
            },
            {
                question: "Tuliskan Surah Al-'Ādiyāt ayat 2!",
                answers: [
                    "وَالْعَادِيَاتِ ضَبْحًا",
                    "فَالْمُورِيَاتِ قَدْحًا",
                    "فَالْمُغِيرَاتِ صُبْحًا"
                ],
                correctIndex: 1
            },
            {
                question: "Sebutkan bunyi bacaan Surah At-Tīn ayat 2!",
                answers: [
                    "وَالتِّينِ وَالزَّيْتُونِ",
                    "وَطُورِ سِينِينَ",
                    "وَهَذَا الْبَلَدِ الْأَمِينِ"
                ],
                correctIndex: 1
            },
            {
                question: "Sebutkan contoh bacaan izhār ḥalqī dalam Surah At-Tīn!",
                answers: [
                    "خَلَقْنَا الْإِنسَانَ",
                    "فِي أَحْسَنِ",
                    "لَقَدْ خَلَقْنَا"
                ],
                correctIndex: 0
            }
        ];
        
        // Sound effects
        const sounds = {
            shoot: new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=="),
            correct: new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=="),
            wrong: new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=="),
            levelUp: new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=="),
            gameOver: new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==")
        };
        
        // Initialize the game
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Sky blue background
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.y = 1.6; // Eye level height
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            gameContainer.appendChild(renderer.domElement);
            
            // Create controls
            controls = new THREE.PointerLockControls(camera, document.body);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Create ground
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x7CFC00,
                roughness: 0.8,
                metalness: 0.2
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Add some decorative elements
            addEnvironment();
            
            // Event listeners
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('click', onMouseClick);
            
            // Start button event
            document.getElementById('start-btn').addEventListener('click', startGame);
            
            // Level up button event
            document.getElementById('level-up-btn').addEventListener('click', startLevel2);
            
            // Restart button event
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            
            // Answer buttons events
            const answerButtons = document.querySelectorAll('.answer-btn');
            answerButtons.forEach(button => {
                button.addEventListener('click', checkAnswer);
            });
            
            // Start animation loop
            animate();
        }
        
        function addEnvironment() {
            // Add trees
            for (let i = 0; i < 20; i++) {
                const treePosition = new THREE.Vector3(
                    Math.random() * 80 - 40,
                    0,
                    Math.random() * 80 - 40
                );
                
                // Don't place trees too close to the center
                if (treePosition.length() < 10) continue;
                
                // Tree trunk
                const trunkGeometry = new THREE.CylinderGeometry(0.2, 0.3, 1.5, 8);
                const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.copy(treePosition);
                trunk.position.y = 0.75;
                trunk.castShadow = true;
                scene.add(trunk);
                
                // Tree leaves
                const leavesGeometry = new THREE.ConeGeometry(1, 2, 8);
                const leavesMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22 });
                const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
                leaves.position.copy(treePosition);
                leaves.position.y = 2.5;
                leaves.castShadow = true;
                scene.add(leaves);
            }
            
            // Add clouds
            for (let i = 0; i < 15; i++) {
                const cloudGroup = new THREE.Group();
                const cloudPosition = new THREE.Vector3(
                    Math.random() * 80 - 40,
                    10 + Math.random() * 5,
                    Math.random() * 80 - 40
                );
                
                const numPuffs = 3 + Math.floor(Math.random() * 3);
                for (let j = 0; j < numPuffs; j++) {
                    const puffGeometry = new THREE.SphereGeometry(0.7 + Math.random() * 0.5, 7, 7);
                    const puffMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0xffffff,
                        roughness: 0.9,
                        metalness: 0.1
                    });
                    const puff = new THREE.Mesh(puffGeometry, puffMaterial);
                    puff.position.set(
                        j * 0.7 - (numPuffs * 0.7) / 2,
                        Math.random() * 0.3,
                        Math.random() * 0.3 - 0.15
                    );
                    cloudGroup.add(puff);
                }
                
                cloudGroup.position.copy(cloudPosition);
                scene.add(cloudGroup);
            }
        }
        
        function createAnimal(type) {
            const animalGroup = new THREE.Group();
            let bodyGeometry, bodyMaterial, headGeometry, headMaterial;
            
            switch (type) {
                case 'rabbit':
                    // Rabbit body
                    bodyGeometry = new THREE.SphereGeometry(0.5, 16, 16);
                    bodyMaterial = new THREE.MeshStandardMaterial({ color: 0xF5F5DC });
                    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                    body.position.y = 0.5;
                    animalGroup.add(body);
                    
                    // Rabbit head
                    headGeometry = new THREE.SphereGeometry(0.3, 16, 16);
                    headMaterial = new THREE.MeshStandardMaterial({ color: 0xF5F5DC });
                    const head = new THREE.Mesh(headGeometry, headMaterial);
                    head.position.set(0, 0.9, 0.3);
                    animalGroup.add(head);
                    
                    // Rabbit ears
                    const earGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.4, 8);
                    const earMaterial = new THREE.MeshStandardMaterial({ color: 0xF5F5DC });
                    
                    const leftEar = new THREE.Mesh(earGeometry, earMaterial);
                    leftEar.position.set(-0.15, 1.2, 0.3);
                    leftEar.rotation.x = -Math.PI / 8;
                    leftEar.rotation.z = -Math.PI / 8;
                    animalGroup.add(leftEar);
                    
                    const rightEar = new THREE.Mesh(earGeometry, earMaterial);
                    rightEar.position.set(0.15, 1.2, 0.3);
                    rightEar.rotation.x = -Math.PI / 8;
                    rightEar.rotation.z = Math.PI / 8;
                    animalGroup.add(rightEar);
                    
                    // Rabbit tail
                    const tailGeometry = new THREE.SphereGeometry(0.15, 8, 8);
                    const tailMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF });
                    const tail = new THREE.Mesh(tailGeometry, tailMaterial);
                    tail.position.set(0, 0.5, -0.5);
                    animalGroup.add(tail);
                    break;
                    
                case 'chicken':
                    // Chicken body
                    bodyGeometry = new THREE.SphereGeometry(0.4, 16, 16);
                    bodyMaterial = new THREE.MeshStandardMaterial({ color: 0xFFD700 });
                    const chickenBody = new THREE.Mesh(bodyGeometry, bodyMaterial);
                    chickenBody.position.y = 0.4;
                    chickenBody.scale.z = 1.2;
                    animalGroup.add(chickenBody);
                    
                    // Chicken head
                    headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
                    headMaterial = new THREE.MeshStandardMaterial({ color: 0xFFD700 });
                    const chickenHead = new THREE.Mesh(headGeometry, headMaterial);
                    chickenHead.position.set(0, 0.8, 0.2);
                    animalGroup.add(chickenHead);
                    
                    // Chicken beak
                    const beakGeometry = new THREE.ConeGeometry(0.1, 0.2, 4);
                    const beakMaterial = new THREE.MeshStandardMaterial({ color: 0xFF4500 });
                    const beak = new THREE.Mesh(beakGeometry, beakMaterial);
                    beak.position.set(0, 0.8, 0.5);
                    beak.rotation.x = Math.PI / 2;
                    animalGroup.add(beak);
                    
                    // Chicken comb
                    const combGeometry = new THREE.BoxGeometry(0.1, 0.15, 0.05);
                    const combMaterial = new THREE.MeshStandardMaterial({ color: 0xFF0000 });
                    const comb = new THREE.Mesh(combGeometry, combMaterial);
                    comb.position.set(0, 1, 0.2);
                    animalGroup.add(comb);
                    
                    // Chicken legs
                    const legGeometry = new THREE.CylinderGeometry(0.03, 0.03, 0.3, 8);
                    const legMaterial = new THREE.MeshStandardMaterial({ color: 0xFF8C00 });
                    
                    const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
                    leftLeg.position.set(-0.15, 0.15, 0);
                    animalGroup.add(leftLeg);
                    
                    const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
                    rightLeg.position.set(0.15, 0.15, 0);
                    animalGroup.add(rightLeg);
                    break;
                    
                case 'cat':
                    // Cat body
                    bodyGeometry = new THREE.SphereGeometry(0.4, 16, 16);
                    bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
                    const catBody = new THREE.Mesh(bodyGeometry, bodyMaterial);
                    catBody.position.y = 0.4;
                    catBody.scale.z = 1.5;
                    animalGroup.add(catBody);
                    
                    // Cat head
                    headGeometry = new THREE.SphereGeometry(0.3, 16, 16);
                    headMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
                    const catHead = new THREE.Mesh(headGeometry, headMaterial);
                    catHead.position.set(0, 0.7, 0.4);
                    animalGroup.add(catHead);
                    
                    // Cat ears
                    const catEarGeometry = new THREE.ConeGeometry(0.1, 0.2, 4);
                    const catEarMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
                    
                    const leftCatEar = new THREE.Mesh(catEarGeometry, catEarMaterial);
                    leftCatEar.position.set(-0.15, 0.95, 0.4);
                    leftCatEar.rotation.x = -Math.PI / 4;
                    animalGroup.add(leftCatEar);
                    
                    const rightCatEar = new THREE.Mesh(catEarGeometry, catEarMaterial);
                    rightCatEar.position.set(0.15, 0.95, 0.4);
                    rightCatEar.rotation.x = -Math.PI / 4;
                    animalGroup.add(rightCatEar);
                    
                    // Cat tail
                    const catTailGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.6, 8);
                    const catTailMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
                    const catTail = new THREE.Mesh(catTailGeometry, catTailMaterial);
                    catTail.position.set(0, 0.4, -0.6);
                    catTail.rotation.x = Math.PI / 4;
                    animalGroup.add(catTail);
                    break;
            }
            
            // Add eyes to all animals
            const eyeGeometry = new THREE.SphereGeometry(0.05, 8, 8);
            const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
            
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.1, 0.1, 0.25);
            
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.1, 0.1, 0.25);
            
            if (type === 'rabbit') {
                leftEye.position.set(-0.1, 0.95, 0.55);
                rightEye.position.set(0.1, 0.95, 0.55);
            } else if (type === 'chicken') {
                leftEye.position.set(-0.1, 0.85, 0.4);
                rightEye.position.set(0.1, 0.85, 0.4);
            } else if (type === 'cat') {
                leftEye.position.set(-0.1, 0.75, 0.65);
                rightEye.position.set(0.1, 0.75, 0.65);
            }
            
            animalGroup.add(leftEye);
            animalGroup.add(rightEye);
            
            // Set position
            const angle = Math.random() * Math.PI * 2;
            const distance = 10 + Math.random() * 5;
            animalGroup.position.x = Math.cos(angle) * distance;
            animalGroup.position.z = Math.sin(angle) * distance;
            
            // Look at center
            animalGroup.lookAt(0, 0, 0);
            
            // Add to scene
            scene.add(animalGroup);
            
            // Store animal data
            const animal = {
                mesh: animalGroup,
                type: type,
                speed: level === 1 ? 0.01 : 0.03,
                direction: new THREE.Vector3(
                    Math.random() * 2 - 1,
                    0,
                    Math.random() * 2 - 1
                ).normalize(),
                changeDirectionTime: Math.random() * 200 + 100
            };
            
            animals.push(animal);
            return animal;
        }
        
        function spawnAnimals() {
            const animalTypes = ['rabbit', 'chicken', 'cat'];
            const numAnimals = level === 1 ? 3 : 5;
            
            for (let i = 0; i < numAnimals; i++) {
                const type = animalTypes[Math.floor(Math.random() * animalTypes.length)];
                createAnimal(type);
            }
        }
        
        function moveAnimals() {
            animals.forEach(animal => {
                // Change direction occasionally
                animal.changeDirectionTime--;
                if (animal.changeDirectionTime <= 0) {
                    animal.direction = new THREE.Vector3(
                        Math.random() * 2 - 1,
                        0,
                        Math.random() * 2 - 1
                    ).normalize();
                    animal.changeDirectionTime = Math.random() * 200 + 100;
                }
                
                // Move animal
                animal.mesh.position.x += animal.direction.x * animal.speed;
                animal.mesh.position.z += animal.direction.z * animal.speed;
                
                // Keep within bounds
                const maxDistance = 20;
                const distanceFromCenter = Math.sqrt(
                    animal.mesh.position.x * animal.mesh.position.x +
                    animal.mesh.position.z * animal.mesh.position.z
                );
                
                if (distanceFromCenter > maxDistance) {
                    // Turn back toward center
                    animal.direction = new THREE.Vector3(
                        -animal.mesh.position.x,
                        0,
                        -animal.mesh.position.z
                    ).normalize();
                }
                
                // Make animal face direction of movement
                animal.mesh.lookAt(
                    animal.mesh.position.x + animal.direction.x,
                    animal.mesh.position.y,
                    animal.mesh.position.z + animal.direction.z
                );
            });
        }
        
        function onMouseClick(event) {
            if (!isGameActive || questionModal.style.display === 'block') return;
            
            // Play shoot sound
            sounds.shoot.play().catch(e => console.log("Audio play failed:", e));
            
            // Create water splash effect
            createWaterSplash();
            
            // Check if an animal was hit
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            const intersects = raycaster.intersectObjects(scene.children, true);
            
            for (let i = 0; i < intersects.length; i++) {
                const object = intersects[i].object;
                
                // Find which animal was hit
                for (let j = 0; j < animals.length; j++) {
                    if (object.parent === animals[j].mesh || isChildOf(object, animals[j].mesh)) {
                        currentAnimal = animals[j];
                        showQuestion();
                        return;
                    }
                }
            }
        }
        
        function isChildOf(child, parent) {
            let current = child.parent;
            while (current) {
                if (current === parent) return true;
                current = current.parent;
            }
            return false;
        }
        
        function createWaterSplash() {
            // Create water splash particles
            const particleCount = 20;
            const particleGroup = new THREE.Group();
            
            for (let i = 0; i < particleCount; i++) {
                const particleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                const particleMaterial = new THREE.MeshBasicMaterial({ color: 0x00BFFF });
                const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                
                // Set initial position at camera
                particle.position.set(0, 0, -1);
                particle.position.applyMatrix4(camera.matrixWorld);
                
                // Set random velocity in forward direction
                const velocity = new THREE.Vector3(
                    Math.random() * 0.2 - 0.1,
                    Math.random() * 0.2 - 0.1,
                    -Math.random() * 0.5 - 0.5
                );
                velocity.applyQuaternion(camera.quaternion);
                
                particle.userData.velocity = velocity;
                particle.userData.life = 20;
                
                particleGroup.add(particle);
            }
            
            scene.add(particleGroup);
            
            // Animate particles
            const animateParticles = function() {
                let allDead = true;
                
                particleGroup.children.forEach(particle => {
                    if (particle.userData.life > 0) {
                        particle.position.add(particle.userData.velocity);
                        particle.userData.velocity.y -= 0.01; // Gravity
                        particle.userData.life--;
                        allDead = false;
                    } else {
                        particle.visible = false;
                    }
                });
                
                if (!allDead) {
                    requestAnimationFrame(animateParticles);
                } else {
                    scene.remove(particleGroup);
                }
            };
            
            animateParticles();
        }
        
        function showQuestion() {
            // Pause game
            controls.unlock();
            
            // Get random question
            const questionIndex = Math.floor(Math.random() * questions.length);
            const question = questions[questionIndex];
            
            // Set question text
            document.getElementById('question-text').textContent = question.question;
            
            // Set answer buttons
            const answerButtons = document.querySelectorAll('.answer-btn');
            for (let i = 0; i < answerButtons.length; i++) {
                answerButtons[i].textContent = question.answers[i];
                answerButtons[i].dataset.correct = (i === question.correctIndex) ? 'true' : 'false';
            }
            
            // Show modal
            questionModal.style.display = 'block';
        }
        
        function checkAnswer(event) {
            const isCorrect = event.target.dataset.correct === 'true';
            
            if (isCorrect) {
                // Play correct sound
                sounds.correct.play().catch(e => console.log("Audio play failed:", e));
                
                // Increase score
                score += 10;
                scoreDisplay.textContent = `Skor: ${score}`;
                
                // Show feedback
                showFeedback("MasyaAllah, benar!", true);
                
                // Remove animal
                if (currentAnimal) {
                    scene.remove(currentAnimal.mesh);
                    animals = animals.filter(animal => animal !== currentAnimal);
                    currentAnimal = null;
                }
                
                // Check if all animals are gone
                if (animals.length === 0) {
                    if (level === 1) {
                        // Show level up screen
                        levelUpScreen.style.display = 'flex';
                        sounds.levelUp.play().catch(e => console.log("Audio play failed:", e));
                    } else {
                        // Game completed
                        endGame(true);
                    }
                }
            } else {
                // Play wrong sound
                sounds.wrong.play().catch(e => console.log("Audio play failed:", e));
                
                // Show feedback
                showFeedback("Coba lagi ya!", false);
            }
            
            // Hide question modal
            questionModal.style.display = 'none';
            
            // Resume game
            controls.lock();
        }
        
        function showFeedback(message, isCorrect) {
            feedbackElement.textContent = message;
            feedbackElement.style.color = isCorrect ? '#4CAF50' : '#f44336';
            feedbackElement.style.opacity = '1';
            
            setTimeout(() => {
                feedbackElement.style.opacity = '0';
            }, 1500);
        }
        
        function startGame() {
            // Hide start screen
            startScreen.style.display = 'none';
            
            // Lock pointer
            controls.lock();
            
            // Spawn animals
            spawnAnimals();
            
            // Set game as active
            isGameActive = true;
            
            // Setup pointer lock controls
            controls.addEventListener('lock', function() {
                questionModal.style.display = 'none';
            });
            
            controls.addEventListener('unlock', function() {
                if (isGameActive && questionModal.style.display !== 'block' &&
                    levelUpScreen.style.display !== 'flex' &&
                    gameOverScreen.style.display !== 'flex') {
                    setTimeout(() => {
                        controls.lock();
                    }, 100);
                }
            });
        }
        
        function startLevel2() {
            // Hide level up screen
            levelUpScreen.style.display = 'none';
            
            // Update level
            level = 2;
            levelDisplay.textContent = `Level: ${level}`;
            
            // Show timer
            timerDisplay.style.display = 'block';
            
            // Spawn more animals
            spawnAnimals();
            
            // Start timer
            startTimer();
            
            // Lock pointer
            controls.lock();
        }
        
        function startTimer() {
            timer = 60;
            timerDisplay.textContent = `Waktu: ${timer}`;
            
            timerInterval = setInterval(() => {
                timer--;
                timerDisplay.textContent = `Waktu: ${timer}`;
                
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    endGame(false);
                }
            }, 1000);
        }
        
        function endGame(completed) {
            // Clear timer
            clearInterval(timerInterval);
            
            // Set game as inactive
            isGameActive = false;
            
            // Unlock controls
            controls.unlock();
            
            // Show game over screen
            document.getElementById('final-score').textContent = score;
            gameOverScreen.style.display = 'flex';
            
            // Play sound
            if (completed) {
                sounds.levelUp.play().catch(e => console.log("Audio play failed:", e));
            } else {
                sounds.gameOver.play().catch(e => console.log("Audio play failed:", e));
            }
        }
        
        function restartGame() {
            // Reset game variables
            score = 0;
            level = 1;
            timer = 60;
            
            // Update displays
            scoreDisplay.textContent = `Skor: ${score}`;
            levelDisplay.textContent = `Level: ${level}`;
            timerDisplay.style.display = 'none';
            
            // Clear animals
            animals.forEach(animal => {
                scene.remove(animal.mesh);
            });
            animals = [];
            
            // Hide game over screen
            gameOverScreen.style.display = 'none';
            
            // Start game
            startGame();
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (isGameActive) {
                moveAnimals();
            }
            
            renderer.render(scene, camera);
        }
        
        // Initialize the game
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96591945b081b5c0',t:'MTc1MzU4NzQ1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
